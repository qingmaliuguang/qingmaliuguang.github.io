<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="SpringBoot-web-问题记录"/>




  <meta name="keywords" content="SpringBoot," />





  <link rel="alternate" href="/default" title="青马流光的博客" >




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="http://blog.coder.love/2022/03/21/for-source-read-web_问题记录/"/>


<meta name="description" content="1. lib spring-core 无法关联源码？解决：spring-core依赖中的jar是0字节，需删除重新倒入该依赖。即可。 2. 中文编码问题？参考：https:&#x2F;&#x2F;docs.spring.io&#x2F;spring-boot&#x2F;docs&#x2F;2.6.4&#x2F;reference&#x2F;htmlsingle&#x2F;#web.servlet.spring-mvc.message-converters中17.4.4。说明：">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot-web-问题记录">
<meta property="og:url" content="http://blog.coder.love/2022/03/21/for-source-read-web_%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="青马流光的博客">
<meta property="og:description" content="1. lib spring-core 无法关联源码？解决：spring-core依赖中的jar是0字节，需删除重新倒入该依赖。即可。 2. 中文编码问题？参考：https:&#x2F;&#x2F;docs.spring.io&#x2F;spring-boot&#x2F;docs&#x2F;2.6.4&#x2F;reference&#x2F;htmlsingle&#x2F;#web.servlet.spring-mvc.message-converters中17.4.4。说明：">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-03-21T07:06:25.000Z">
<meta property="article:modified_time" content="2023-04-29T03:17:09.314Z">
<meta property="article:author" content="青马流光">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?65a3f3228e88e62009896032ddcfdf2b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



    <title> SpringBoot-web-问题记录 - 青马流光的博客 </title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">青马流光的博客</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          SpringBoot-web-问题记录
        
      </h1>

      <time class="post-time">
          3月 21 2022
      </time>
    </header>



    
            <div class="post-content">
            <h3 id="1-lib-spring-core-无法关联源码？"><a href="#1-lib-spring-core-无法关联源码？" class="headerlink" title="1. lib spring-core 无法关联源码？"></a>1. lib spring-core 无法关联源码？</h3><p>解决：spring-core依赖中的jar是0字节，需删除重新倒入该依赖。即可。</p>
<h3 id="2-中文编码问题？"><a href="#2-中文编码问题？" class="headerlink" title="2. 中文编码问题？"></a>2. 中文编码问题？</h3><p>参考：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.6.4/reference/htmlsingle/#web.servlet.spring-mvc.message-converters">https://docs.spring.io/spring-boot/docs/2.6.4/reference/htmlsingle/#web.servlet.spring-mvc.message-converters</a><br>中17.4.4。<br>说明：Spring MVC使用HttpMessageConverter接口来转换HTTP请求和响应。明智的默认值包括在开箱即用。例如，对象可以自动转换为JSON(通过使用Jackson库)或XML(如果Jackson XML扩展可用，则使用Jackson XML扩展;如果Jackson XML扩展不可用，则使用JAXB)。默认情况下，字符串采用UTF-8编码。<br>如果你需要添加或自定义转换器，你可以使用Spring Boot的HttpMessageConverters类，如下所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHttpMessageConvertersConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> HttpMessageConverters <span class="title">customConverters</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HttpMessageConverter&lt;?&gt; additional = <span class="keyword">new</span> AdditionalHttpMessageConverter();</span><br><span class="line">    HttpMessageConverter&lt;?&gt; another = <span class="keyword">new</span> AnotherHttpMessageConverter();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HttpMessageConverters(additional, another);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上下文中出现的任何HttpMessageConverter bean都被添加到转换器列表中。您也可以用同样的方法重写默认转换器。<br>Spring使用HttpMessageConverters来渲染@ResponseBody(或@RestController的响应)。您可以通过在Spring Boot上下文中添加适当类型的bean来贡献其他转换器。如果您添加的bean是默认情况下已经包含的类型(例如用于JSON转换的MappingJackson2HttpMessageConverter)，那么它将替换默认值。提供了HttpMessageConverters类型的方便bean，如果您使用默认的MVC配置，它总是可用的。它有一些有用的方法来访问默认的和用户增强的消息转换器(例如，如果您想手动将它们注入到自定义的RestTemplate中，它可能很有用)。<br>解决：如HttpMessageConverterConfig。</p>
<h3 id="3-Aspect-找不到。"><a href="#3-Aspect-找不到。" class="headerlink" title="3. @Aspect 找不到。"></a>3. @Aspect 找不到。</h3><p>解决：添加依赖spring-boot-starter-aop，它会引入aspectjweaver依赖，@Aspect为其中注解。</p>
<h3 id="4-未生效"><a href="#4-未生效" class="headerlink" title="4. 未生效"></a>4. 未生效</h3><p>解决：@Aspect类要通过添加@Component或@Bean等注解由容器创建其实例才能生效。</p>
<h3 id="5-After逻辑中通过Method对象获取的方法上的注解列表不完整"><a href="#5-After逻辑中通过Method对象获取的方法上的注解列表不完整" class="headerlink" title="5. @After逻辑中通过Method对象获取的方法上的注解列表不完整"></a>5. @After逻辑中通过Method对象获取的方法上的注解列表不完整</h3><p>见：BizLogAspect。</p>
<p>原因：自定义的注解BizLogAnnotation没有添加元注解@Retention(RetentionPolicy.RUNTIME)。</p>
<blockquote>
<p>扩展：通过代理模式生成代理对象上的方法不会有注解，我们要取注解只能从目标对象中取。</p>
<p>错误写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此处method获取的是代理对象（由代理模式生成的对象）的方法</span></span><br><span class="line">Method method1 = ((MethodSignature) joinPoint.getSignature()).getMethod();</span><br><span class="line"><span class="comment">// 此处annotation==null</span></span><br><span class="line">Annotation annotation = method1.getAnnotation(BizLogAnnotation.class);</span><br></pre></td></tr></table></figure>

<p>正确写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">targetClass = Class.forName(targetName);</span><br><span class="line"><span class="comment">// 此处是目标对象的原始方法。</span></span><br><span class="line">Method[] methods = targetClass.getMethods();</span><br><span class="line">BizLogAnnotation bizLogAnnotation = methods[<span class="number">0</span>].getAnnotation(BizLogAnnotation.class);</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="6-Indexed注解"><a href="#6-Indexed注解" class="headerlink" title="6. @Indexed注解"></a>6. @Indexed注解</h3><p>注释中描述：</p>
<blockquote>
<p>指示带注解的元素表示索引的构造型。</p>
<p>CandidateComponentsIndex是类路径扫描的替代方法，它使用在编译时生成的元数据文件。索引允许基于原型检索候选组件(即完全限定的名称) 。该注解指示生成器对存在注释元素的元素进行索引，或者对注释元素进行实现或扩展。原型是被注释元素的完全限定名称。</p>
<p>考虑默认的Component注解，它是用这个注解进行元注解的。如果一个组件用Component来注解，那么该组件的一个条目将会被org.springframework.stereotype.Component模板添加到索引中。</p>
<p>这个注解也在元注解中得到了尊重。考虑如下定制注解:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line">  </span><br><span class="line">   <span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line">   <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">   <span class="meta">@Documented</span></span><br><span class="line">   <span class="meta">@Indexed</span></span><br><span class="line">   <span class="meta">@Service</span></span><br><span class="line">   <span class="keyword">public</span> <span class="meta">@interface</span> PrivilegedService &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>如果上面的注释出现在一个类型上，它将被两个原型索引:org.springframework.stereotype.Component和com.example .PrivilegedService。虽然Service不是直接用Indexed注释的，但它是用Component元注释的。</p>
<p>也可以通过添加@Indexed来索引某个接口的所有实现或者给定类的所有子类。考虑以下基本接口:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line">  </span><br><span class="line">   <span class="meta">@Indexed</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AdminService</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>现在，考虑在某个地方实现这个AdminService:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.foo;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">import</span> com.example.AdminService;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigurationAdminService</span> <span class="keyword">implements</span> <span class="title">AdminService</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>因为这个类实现了一个被索引的接口，所以它将被自动包含在com.example.AdminService原型中。如果层次结构中有更多的@Indexed接口和/或超类，类将映射到它们所有的原型。</p>
</blockquote>
<p>其它参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/54chensongxia/p/14389134.html">@Indexed注解</a>、<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.6.RELEASE/spring-framework-reference/core.html#beans-scanning-index">官方文档</a>，但是6.0.0-M2版本官方文档中无相关介绍。</p>
<h3 id="7-Scope注解是怎么生效的？"><a href="#7-Scope注解是怎么生效的？" class="headerlink" title="7. @Scope注解是怎么生效的？"></a>7. @Scope注解是怎么生效的？</h3><p>ConfigurationClassPostProcessor</p>
<blockquote>
<p>BeanDefinitionRegistryPostProcessor</p>
<ul>
<li>扩展到标准的BeanFactoryPostProcessor SPI，允许在常规BeanFactoryPostProcessor检测开始之前注册更多的bean定义。特别是，BeanDefinitionRegistryPostProcessor可以注册更多的bean定义，这些定义反过来又定义了BeanFactoryPostProcessor实例。</li>
<li>继承自BeanFactoryPostProcessor。</li>
</ul>
</blockquote>
<p>-&gt; <strong>ConfigurationClassBeanDefinitionReader</strong>:loadBeanDefinitions中会检查有无@Scope注解，若有则根据其属性填充bean定义。</p>
<h3 id="8-jakarta-servlet-amp-javax-servlet-gt-jakarta与javax的关系？"><a href="#8-jakarta-servlet-amp-javax-servlet-gt-jakarta与javax的关系？" class="headerlink" title="8. jakarta.servlet &amp; javax.servlet  =&gt;  jakarta与javax的关系？"></a>8. jakarta.servlet &amp; javax.servlet  =&gt;  jakarta与javax的关系？</h3><blockquote>
<ul>
<li>jakarta来自于javax，因捐献与版权问题而产生。参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/dnc8371/article/details/106701108">没有Javax的Jakarta EE</a></li>
<li><a target="_blank" rel="noopener" href="https://jakarta.ee/specifications/platform/">Jakarta EE Platform官方文档</a></li>
</ul>
</blockquote>
<h2 id="9-Lookup注解"><a href="#9-Lookup注解" class="headerlink" title="9. @Lookup注解"></a>9. @Lookup注解</h2><blockquote>
<ul>
<li><p>用法，<a target="_blank" rel="noopener" href="https://blog.csdn.net/dezhonger/article/details/95238732">参考</a></p>
</li>
<li><p>是如何起作用的？</p>
<blockquote>
</blockquote>
</li>
</ul>
</blockquote>
<h1 id="待整理内容"><a href="#待整理内容" class="headerlink" title="待整理内容"></a>待整理内容</h1><ul>
<li><p>DefaultAopProxyFactory</p>
</li>
<li><p>AbstractAspectJAdvisorFactory -&gt; ReflectiveAspectJAdvisorFactory</p>
<blockquote>
<p>Spring AOP支持的Aspectj注解：Pointcut.class, Around.class, Before.class, After.class, AfterReturning.class, AfterThrowing.class。</p>
</blockquote>
</li>
<li><p>AnnotationUtils</p>
</li>
</ul>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/SpringBoot/">SpringBoot</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2022/03/21/Synchronized/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Synchronized</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2022/03/21/%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83%E9%9B%B6%E6%95%A3%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/">
        <span class="next-text nav-default">语言规范零散问题记录.md</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2023
    <span class="footer-author">青马流光.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> and <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
